<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.osaz.danaka.product.model.dao.ProductMapper">
    <resultMap type="com.osaz.danaka.product.model.dto.ProductDTO" id="productResultMap">
        <id property="productNo" column="PRODUCT_NO"/>
        <result property="categoryCode" column="CATEGORY_CODE"/>
        <result property="brandNo" column="BRAND_NO"/>
        <result property="productName" column="PRODUCT_NAME"/>
        <result property="productRegDate" column="PRODUCT_REG_DATE"/>
        <result property="stock" column="STOCK"/>
        <association property="rod" resultMap="rodResultMap"/>
        <association property="reel" resultMap="reelResultMap"/>
        <association property="line" resultMap="lineResultMap"/>
    </resultMap>
    <resultMap type="com.osaz.danaka.product.model.dto.RodDTO" id="rodResultMap">
        <id property="productNo" column="PRODUCT_NO"/>
        <result property="model" column="ROD_MODEL"/>
        <result property="reelType" column="ROD_REEL_TYPE"/>
        <result property="lineMin" column="LINE_MIN"/>
        <result property="lineMax" column="LINE_MAX"/>
        <result property="price" column="ROD_PRICE"/>
    </resultMap>
    <resultMap type="com.osaz.danaka.product.model.dto.ReelDTO" id="reelResultMap">
        <id property="productNo" column="PRODUCT_NO"/>
        <result property="model" column="REEL_MODEL"/>
        <result property="reelType" column="REEL_TYPE"/>
        <result property="price" column="REEL_PRICE"/>
    </resultMap>
    <resultMap type="com.osaz.danaka.product.model.dto.LineDTO" id="lineResultMap">
        <id property="productNo" column="PRODUCT_NO"/>
        <result property="lineSize" column="LINE_SIZE"/>
        <result property="price" column="LINE_PRICE"/>
    </resultMap>

    <select id="selectByCategory" parameterType="String" resultMap="productResultMap">
        SELECT
            *
          FROM VIEW_PRODUCT
         WHERE CATEGORY_CODE = #{ categoryCode }
    </select>
    <select id="selectOne" parameterType="String" resultMap="productResultMap">
        SELECT
            *
          FROM VIEW_PRODUCT
         WHERE PRODUCT_NO = #{ productNo }
    </select>
    <insert id="registWishList" parameterType="Map">
        INSERT INTO T_WISHLIST
        VALUES
            (
             SEQ_WISH_NO.NEXTVAL,
             #{ userNo },
             #{ productNo }
            )
    </insert>


    <!--상품 테이블 데이터 삽입-->
    <insert id="insertProduct">
        INSERT
        INTO T_PRODUCT A
        (
            A.PRODUCT_NO
        , A.CATEGORY_CODE
        , A.BRAND_NO
        , A.PRODUCT_REG_DATE
        , A.PRODUCT_NAME
        , A.STOCK
        )
        VALUES
            (
                SEQ_PRODUCT_NO.NEXTVAL
            , #{ categoryCode }
            , #{ brandNo }
            , DEFAULT
            , #{ productName }
            , #{ stock }
            )
    </insert>

    <!--기준에 따라 카테고리 테이블 데이터 삽입-->
    <insert id="insertCategory" parameterType="Map">
        INSERT INTO ${ category }
        <if test="category == 'T_ROD'">
            VALUES
            (
            #{ lastNum }
            , #{ rodModel }
            , #{ reelType }
            , #{ lineMin }
            , #{ lineMax }
            , #{ rodPrice }
            )
        </if>
        <if test="category == 'T_REEL'">
            VALUES
            (
            #{ lastNum }
            , #{ reelModel }
            , #{ reelType }
            , #{ reelPrice }
            )
        </if>
        <if test="category == 'T_LINE'">
            VALUES
            (
            #{ lastNum }
            , #{ lineSize }
            , #{ linePrice }
            )
        </if>
    </insert>

    <!--T_PRODUCT 테이블 마지막 번호 구하기-->
    <select id="selectProductLastNum" resultType="string">
        SELECT MAX(PRODUCT_NO)
        FROM T_PRODUCT
    </select>

    <!--T_IMG_PATH 데이터 추가-->
    <insert id="insertImgFile" parameterType="com.osaz.danaka.product.model.dto.imgPathDTO">
        INSERT
        INTO T_IMG_PATH A
        (
            A.IMG_NO
        , A.PRODUCT_NO
        , A.IMG_CATEGORY
        , A.ORG_FILE_NAME
        , A.SYS_FILE_NAME
        , A.SAVE_PATH
        )
        VALUES
            (
                SEQ_IMG_NO.NEXTVAL
            , #{ productNo }
            , #{ imgCategory }
            , #{ orgFileName }
            , #{ sysFileName}
            , #{ savePath }
            )
    </insert>
</mapper>